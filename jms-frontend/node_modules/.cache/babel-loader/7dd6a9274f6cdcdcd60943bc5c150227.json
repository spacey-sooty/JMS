{"ast":null,"code":"import _classCallCheck from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import BufferedFormControl from\"components/elements/BufferedFormControl\";import{confirmModal}from\"components/elements/Confirm\";import React from\"react\";import{Button,Col,Container,ListGroup,Row}from\"react-bootstrap\";import{Link,Route,Routes,useParams}from\"react-router-dom\";import{withValU}from\"support/util\";import{WebsocketComponent}from\"support/ws-component\";import newTicket from\"./NewTicket\";import TicketView from\"./Ticket\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export function get_csa_name(fta){return fta?\"FTA\":sessionStorage.getItem(\"csa_name\");}export function set_csa_name(name){sessionStorage.setItem(\"csa_name\",name);}var CSAIndex=/*#__PURE__*/function(_WebsocketComponent){_inherits(CSAIndex,_WebsocketComponent);var _super=_createSuper(CSAIndex);function CSAIndex(){var _this;_classCallCheck(this,CSAIndex);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={tickets:[],matches:[],teams:[]};_this.componentDidMount=function(){if(get_csa_name(_this.props.fta)==null){_this.promptName();}_this.handles=[_this.listen(\"Ticket/All\",\"tickets\"),_this.listen(\"Match/All\",\"matches\"),_this.listen(\"Event/Team/CurrentAll\",\"teams\")];};_this.promptName=function(){confirmModal(\"\",{data:\"\",title:\"Set Name\",okText:\"Set Name\",renderInner:function renderInner(name,_onUpdate,ok){return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{children:\" My name is... \"}),/*#__PURE__*/_jsx(BufferedFormControl,{instant:true,autofocus:true,type:\"text\",value:name,onUpdate:function onUpdate(v){return _onUpdate(String(v));},onEnter:ok})]});}}).then(set_csa_name);};_this.renderTickets=function(tickets){if(tickets.length===0)return/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\" No tickets to display \"});var matches=_this.state.matches;return/*#__PURE__*/_jsx(ListGroup,{children:tickets.map(function(t){return/*#__PURE__*/_jsx(Link,{to:\"\".concat(t.id),children:/*#__PURE__*/_jsx(ListGroup.Item,{action:true,className:\"support-ticket-preview\",\"data-resolved\":t.resolved,children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:2,children:[\" \",t.team,\" \"]}),/*#__PURE__*/_jsxs(Col,{md:4,children:[\" \",t.issue_type,\" \"]}),/*#__PURE__*/_jsxs(Col,{md:4,className:\"text-muted\",children:[\" \",t.assigned_to||\"Unassigned\",\" \"]}),/*#__PURE__*/_jsxs(Col,{md:2,children:[\" \",withValU(t.match_id,function(id){var _matches$find;return(_matches$find=matches.find(function(m){return m.id===id;}))===null||_matches$find===void 0?void 0:_matches$find.short_name;}),\" \"]})]})},t.id)});})});};return _this;}_createClass(CSAIndex,[{key:\"render\",value:function render(){var _this2=this;var fta=this.props.fta;var _this$state=this.state,tickets=_this$state.tickets,teams=_this$state.teams,matches=_this$state.matches;var my_name=get_csa_name(fta)||\"Unnamed CSA\";return/*#__PURE__*/_jsxs(Container,{className:\"csa-index\",children:[/*#__PURE__*/_jsxs(Row,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"h3\",{children:[\" Hello \",my_name,\" \"]})}),/*#__PURE__*/_jsxs(Col,{className:\"text-end\",children:[/*#__PURE__*/_jsx(Button,{onClick:this.promptName,children:\" Change Name \"}),/*#__PURE__*/_jsx(Button,{className:\"mx-2\",onClick:function onClick(){return newTicket(my_name,teams.map(function(x){return x.id;}),matches,function(t){return _this2.send({Ticket:{Insert:t}});});},children:\" New Ticket \"})]})]}),/*#__PURE__*/_jsxs(Row,{className:\"flex-wrap\",children:[/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h4\",{children:\" My Tickets \"}),this.renderTickets(tickets.filter(function(t){var _t$assigned_to;return my_name!=null&&!t.resolved&&((_t$assigned_to=t.assigned_to)===null||_t$assigned_to===void 0?void 0:_t$assigned_to.toLowerCase())===my_name.toLowerCase();}))]})}),/*#__PURE__*/_jsx(Row,{className:\"mt-2\",children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h4\",{children:\" Unassigned Tickets \"}),this.renderTickets(tickets.filter(function(t){return t.assigned_to===null;}))]})})]}),/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h4\",{children:\" Other Tickets \"}),this.renderTickets(tickets.filter(function(t){var _t$assigned_to2;return my_name===null||t.assigned_to!=null&&(t.resolved||((_t$assigned_to2=t.assigned_to)===null||_t$assigned_to2===void 0?void 0:_t$assigned_to2.toLowerCase())!=my_name.toLowerCase());}))]})]})]});}}]);return CSAIndex;}(WebsocketComponent);export{CSAIndex as default};function TicketViewWrapper(props){var _useParams=useParams(),id=_useParams.id;if(id!=null)return/*#__PURE__*/_jsx(TicketView,{id:parseInt(id),fta:props.fta});return/*#__PURE__*/_jsx(\"h4\",{children:\" Page not found! \"});}export function CSARouter(props){return/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(CSAIndex,{fta:props.fta})}),/*#__PURE__*/_jsx(Route,{path:\"/:id\",element:/*#__PURE__*/_jsx(TicketViewWrapper,{fta:props.fta})})]});}","map":{"version":3,"names":["BufferedFormControl","confirmModal","React","Button","Col","Container","ListGroup","Row","Link","Route","Routes","useParams","withValU","WebsocketComponent","newTicket","TicketView","get_csa_name","fta","sessionStorage","getItem","set_csa_name","name","setItem","CSAIndex","state","tickets","matches","teams","componentDidMount","props","promptName","handles","listen","data","title","okText","renderInner","onUpdate","ok","v","String","then","renderTickets","length","map","t","id","resolved","team","issue_type","assigned_to","match_id","find","m","short_name","my_name","x","send","Ticket","Insert","filter","toLowerCase","TicketViewWrapper","parseInt","CSARouter"],"sources":["/home/spacey_sooty/Documents/projects/JMS/jms-frontend/src/csa/CSAIndex.tsx"],"sourcesContent":["import BufferedFormControl from \"components/elements/BufferedFormControl\";\nimport { confirmModal } from \"components/elements/Confirm\";\nimport React from \"react\"\nimport { Button, Col, Container, ListGroup, Row } from \"react-bootstrap\";\nimport { Link, Route, Routes, useParams } from \"react-router-dom\";\nimport { withValU } from \"support/util\";\nimport { WebsocketComponent } from \"support/ws-component\"\nimport { SerializedMatch, SupportTicket, Team } from \"ws-schema\";\nimport newTicket from \"./NewTicket\";\nimport TicketView from \"./Ticket\";\n\nexport function get_csa_name(fta: boolean) {\n  return fta ? \"FTA\" : sessionStorage.getItem(\"csa_name\");\n}\n\nexport function set_csa_name(name: string) {\n  sessionStorage.setItem(\"csa_name\", name);\n}\n\ntype CSAIndexProps = {\n  fta: boolean\n};\n\ntype CSAIndexState = {\n  tickets: SupportTicket[],\n  matches: SerializedMatch[],\n  teams: Team[]\n};\n\nexport default class CSAIndex extends WebsocketComponent<CSAIndexProps, CSAIndexState> {\n  readonly state: CSAIndexState = { tickets: [], matches: [], teams: []}\n  \n  componentDidMount = () => {\n    if (get_csa_name(this.props.fta) == null) {\n      this.promptName();\n    }\n\n    this.handles = [\n      this.listen(\"Ticket/All\", \"tickets\"),\n      this.listen(\"Match/All\", \"matches\"),\n      this.listen(\"Event/Team/CurrentAll\", \"teams\")\n    ];\n  }\n\n  promptName = () => {\n    confirmModal(\"\", {\n      data: \"\",\n      title: \"Set Name\",\n      okText: \"Set Name\",\n      renderInner: (name: string, onUpdate, ok) => <React.Fragment>\n        <p> My name is... </p>\n        <BufferedFormControl\n          instant\n          autofocus\n          type=\"text\"\n          value={name}\n          onUpdate={v => onUpdate(String(v))}\n          onEnter={ok}\n        />\n      </React.Fragment>\n    }).then(set_csa_name)\n  }\n\n  renderTickets = (tickets: SupportTicket[]) => {\n    if (tickets.length === 0)\n      return <p className=\"text-muted\"> No tickets to display </p>;\n    \n    const { matches } = this.state;\n\n    return <ListGroup>\n      {\n        tickets.map(t => (\n          <Link to={`${t.id}`}>\n            <ListGroup.Item\n              key={t.id} action\n              className=\"support-ticket-preview\"\n              data-resolved={ t.resolved }\n            >\n              <Row>\n                <Col md={2}> { t.team } </Col>\n                <Col md={4}> { t.issue_type } </Col>\n                <Col md={4} className=\"text-muted\"> { t.assigned_to || \"Unassigned\" } </Col>\n                <Col md={2}> { withValU(t.match_id, id => matches.find(m => m.id === id)?.short_name) } </Col>\n              </Row>\n            </ListGroup.Item>\n          </Link>\n\n        ))\n      }\n    </ListGroup>\n  }\n\n  render() {\n    const { fta } = this.props;\n    const { tickets, teams, matches } = this.state;\n    const my_name = get_csa_name(fta) || \"Unnamed CSA\";\n\n    return <Container className=\"csa-index\">\n      <Row className=\"mb-3\">\n        <Col>\n          <h3> Hello { my_name } </h3>\n        </Col>\n        <Col className=\"text-end\">\n          <Button\n            onClick={this.promptName}\n          > Change Name </Button>\n          <Button\n            className=\"mx-2\"\n            onClick={() => newTicket(my_name, teams.map(x => x.id), matches, t => this.send({\n              Ticket: { Insert: t }\n            }))}\n          > New Ticket </Button>\n        </Col>\n      </Row>\n      <Row className=\"flex-wrap\">\n        <Col>\n          <Row>\n            <Col>\n              <h4> My Tickets </h4>\n              {\n                this.renderTickets(tickets.filter(t => my_name != null && !t.resolved && t.assigned_to?.toLowerCase() === my_name.toLowerCase()))\n              }\n            </Col>\n          </Row>\n          <Row className=\"mt-2\">\n            <Col>\n              <h4> Unassigned Tickets </h4>\n              { this.renderTickets(tickets.filter(t => t.assigned_to === null)) }\n            </Col>\n          </Row>\n        </Col>\n        <Col>\n          <h4> Other Tickets </h4>\n          { this.renderTickets(tickets.filter(t => my_name === null || (t.assigned_to != null && (t.resolved || t.assigned_to?.toLowerCase() != my_name.toLowerCase())))) }\n        </Col>\n      </Row>\n    </Container>\n  }\n}\n\nfunction TicketViewWrapper(props: { fta: boolean }) {\n  const { id } = useParams();\n  if (id != null)\n    return <TicketView id={parseInt(id)} fta={props.fta} />;\n  return <h4> Page not found! </h4>\n}\n\nexport function CSARouter(props: { fta: boolean }) {\n  return <Routes>\n    <Route path=\"/\" element={ <CSAIndex fta={props.fta} /> } />\n    <Route path=\"/:id\" element={ <TicketViewWrapper fta={props.fta} /> } />\n  </Routes>\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}