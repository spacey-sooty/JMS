{"ast":null,"code":"import _objectSpread from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _classCallCheck from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";var _excluded=[\"className\",\"onUpdate\",\"onEnter\",\"autofocus\",\"auto\",\"autoMillis\",\"instant\",\"enter\",\"resetOnEnter\"];import React from\"react\";import{FormControl}from\"react-bootstrap\";import{nullIfEmpty}from\"support/strings\";import{jsx as _jsx}from\"react/jsx-runtime\";var BufferedFormControl=/*#__PURE__*/function(_React$Component){_inherits(BufferedFormControl,_React$Component);var _super=_createSuper(BufferedFormControl);function BufferedFormControl(){var _this;_classCallCheck(this,BufferedFormControl);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.controlRef=/*#__PURE__*/React.createRef();_this.timer=undefined;_this.state={value:_this.props.value};_this.valuesDiffer=function(){var oldV=String(_this.props.value||\"\");var newV=String(_this.state.value||\"\");return oldV!==newV;};_this.triggerUpdate=function(){var _this$props$onUpdate,_this$props;(_this$props$onUpdate=(_this$props=_this.props).onUpdate)===null||_this$props$onUpdate===void 0?void 0:_this$props$onUpdate.call(_this$props,_this.state.value);if(_this.props.resetOnEnter)_this.setState({value:_this.props.value});};_this.changed=function(event){if(_this.props.auto){clearTimeout(_this.timer);_this.timer=setTimeout(function(){return _this.triggerUpdate();},_this.props.autoMillis||250);}var value=event.target.value;if(_this.props.type===\"number\"&&nullIfEmpty(String(value))!=null&&Number(value)!=null){var n=Number(value);value=Math.min(Math.max(n,Number(_this.props.min||Number.NEGATIVE_INFINITY)),Number(_this.props.max||Number.POSITIVE_INFINITY));}// @ts-ignore\n_this.setState({value:value},_this.props.instant?_this.triggerUpdate:undefined);};_this.onKeyDown=function(e){if(_this.props.enter&&e.key==='Enter'){var _this$props$onEnter,_this$props2;_this.triggerUpdate();(_this$props$onEnter=(_this$props2=_this.props).onEnter)===null||_this$props$onEnter===void 0?void 0:_this$props$onEnter.call(_this$props2,_this.state.value);}};_this.focusInput=function(){var _this$controlRef$curr;// @ts-ignore\n(_this$controlRef$curr=_this.controlRef.current)===null||_this$controlRef$curr===void 0?void 0:_this$controlRef$curr.focus();};return _this;}_createClass(BufferedFormControl,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(prevProps.value!==this.props.value){// @ts-ignore\nthis.setState({value:this.props.value||\"\"});// Have to || \"\" otherwise the most controls won't update\n}}},{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.autofocus){var _this$controlRef$curr2;(_this$controlRef$curr2=this.controlRef.current)===null||_this$controlRef$curr2===void 0?void 0:_this$controlRef$curr2.focus();}}},{key:\"render\",value:function render(){var _this$props3=this.props,className=_this$props3.className,onUpdate=_this$props3.onUpdate,onEnter=_this$props3.onEnter,autofocus=_this$props3.autofocus,auto=_this$props3.auto,autoMillis=_this$props3.autoMillis,instant=_this$props3.instant,enter=_this$props3.enter,resetOnEnter=_this$props3.resetOnEnter,props=_objectWithoutProperties(_this$props3,_excluded);return/*#__PURE__*/_jsx(FormControl,_objectSpread(_objectSpread({},props),{},{ref:this.controlRef,className:className,\"data-buffer-diff\":this.valuesDiffer(),onChange:this.changed,onKeyDown:this.onKeyDown,value:this.state.value}));}}]);return BufferedFormControl;}(React.Component);BufferedFormControl.defaultProps={autofocus:false,auto:false,autoMillis:250,instant:false,enter:true,resetOnEnter:false};export{BufferedFormControl as default};","map":{"version":3,"names":["React","FormControl","nullIfEmpty","BufferedFormControl","controlRef","createRef","timer","undefined","state","value","props","valuesDiffer","oldV","String","newV","triggerUpdate","onUpdate","resetOnEnter","setState","changed","event","auto","clearTimeout","setTimeout","autoMillis","target","type","Number","n","Math","min","max","NEGATIVE_INFINITY","POSITIVE_INFINITY","instant","onKeyDown","e","enter","key","onEnter","focusInput","current","focus","prevProps","autofocus","className","Component","defaultProps"],"sources":["/home/spacey_sooty/Documents/projects/JMS/jms-frontend/src/components/elements/BufferedFormControl.tsx"],"sourcesContent":["import React from \"react\";\nimport { FormControl, FormControlProps } from \"react-bootstrap\";\nimport { nullIfEmpty } from \"support/strings\";\nimport { Combine } from \"support/util\";\n\nexport type BufferedProps = Combine<{\n  autofocus?: boolean,\n  auto?: boolean,\n  autoMillis?: number,\n  instant?: boolean,\n  enter?: boolean,\n  value: number | string,\n  onUpdate?: (val: number | string) => void,\n  className?: string,\n  resetOnEnter?: boolean,\n  onEnter?: (val: number | string) => void,\n}, Combine<FormControlProps, React.InputHTMLAttributes<HTMLInputElement>>>;\n\ntype BufferedState = {\n  value: number | string\n};\n\nexport default class BufferedFormControl extends React.Component<BufferedProps, BufferedState> {\n  static defaultProps = {\n    autofocus: false,\n    auto: false,\n    autoMillis: 250,\n    instant: false,\n    enter: true,\n    resetOnEnter: false\n  };\n\n  private controlRef = React.createRef<HTMLInputElement>();\n  private timer: any = undefined;\n\n  readonly state = {\n    value: this.props.value\n  }\n\n  componentDidUpdate(prevProps: BufferedProps) {\n    if (prevProps.value !== this.props.value) {\n      // @ts-ignore\n      this.setState({ value: this.props.value || \"\" });    // Have to || \"\" otherwise the most controls won't update\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.autofocus) {\n      this.controlRef.current?.focus();\n    }\n  }\n\n  valuesDiffer = () => {\n    let oldV = String(this.props.value || \"\");\n    let newV = String(this.state.value || \"\");\n\n    return oldV !== newV;\n  }\n\n  triggerUpdate = () => {\n    this.props.onUpdate?.(this.state.value);\n    if (this.props.resetOnEnter)\n      this.setState({ value: this.props.value });\n  }\n\n  changed = (event: any) => {\n    if (this.props.auto) {\n      clearTimeout(this.timer);\n      this.timer = setTimeout(() => this.triggerUpdate(), this.props.autoMillis || 250);\n    }\n\n    let value = event.target.value;\n\n    if (this.props.type === \"number\" && nullIfEmpty(String(value)) != null && Number(value) != null) {\n      let n = Number(value);\n      value = Math.min(Math.max(n, Number(this.props.min || Number.NEGATIVE_INFINITY)), Number(this.props.max || Number.POSITIVE_INFINITY));\n    }\n\n    // @ts-ignore\n    this.setState({ value: value }, this.props.instant ? this.triggerUpdate : undefined);\n  }\n\n  onKeyDown = (e : {key: string}) => {\n    if (this.props.enter && e.key === 'Enter') {\n      this.triggerUpdate();\n      this.props.onEnter?.(this.state.value);\n    }\n  }\n\n  focusInput = () => {\n    // @ts-ignore\n    this.controlRef.current?.focus();\n  }\n\n  render() {\n    let { className, onUpdate, onEnter, autofocus, auto, autoMillis, instant, enter, resetOnEnter, ...props } = this.props;\n\n    return <FormControl\n      {...props}\n      ref={this.controlRef}\n      className={className}\n      data-buffer-diff={this.valuesDiffer()}\n      onChange={this.changed}\n      onKeyDown={this.onKeyDown}\n      value={this.state.value}\n    />;\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}