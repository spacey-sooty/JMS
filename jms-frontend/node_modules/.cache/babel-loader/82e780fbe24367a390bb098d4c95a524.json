{"ast":null,"code":"import _classCallCheck from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from\"react\";import{Button,Card,Col,Row}from\"react-bootstrap\";import{withValU}from\"support/util\";import{WebsocketComponent}from\"support/ws-component\";import{get_csa_name}from\"./CSAIndex\";import update from\"immutability-helper\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faCheck,faChevronCircleLeft,faTimes,faUserCheck,faUserSlash}from\"@fortawesome/free-solid-svg-icons\";import moment from\"moment\";import BufferedFormControl from\"components/elements/BufferedFormControl\";import{nullIfEmpty}from\"support/strings\";import{Link}from\"react-router-dom\";import MatchLogView from\"monitor/MatchLogView\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TicketView=/*#__PURE__*/function(_WebsocketComponent){_inherits(TicketView,_WebsocketComponent);var _super=_createSuper(TicketView);function TicketView(){var _this;_classCallCheck(this,TicketView);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={};_this.componentDidMount=function(){_this.handles=[_this.listenFn(\"Ticket/All\",function(ticks){return _this.setState({ticket:ticks.find(function(t){return t.id===_this.props.id;})});}),_this.listenFn(\"Match/All\",function(matches){return _this.setState(function(state){return{match:matches.find(function(m){var _state$ticket;return m.id===((_state$ticket=state.ticket)===null||_state$ticket===void 0?void 0:_state$ticket.match_id);})};});})];};_this.update=function(spec){_this.send({Ticket:{Insert:update(_this.state.ticket,spec)}});};_this.renderTicket=function(ticket){var match=_this.state.match;var my_name=get_csa_name(_this.props.fta)||\"Unnamed CSA\";var is_mine=ticket.assigned_to===my_name;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(Row,{className:\"ticket-header\",children:[/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsxs(\"h4\",{children:[/*#__PURE__*/_jsx(Link,{to:\"../\",children:/*#__PURE__*/_jsxs(Button,{variant:\"secondary\",children:[\" \",/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faChevronCircleLeft}),\" \"]})}),\" \\xA0 Team \",ticket.team,\" - \",ticket.issue_type,withValU(match,function(m){return\" in \".concat(m.name);}),ticket.resolved?/*#__PURE__*/_jsx(\"span\",{className:\"text-success\",children:\"\\xA0 [RESOLVED]\"}):undefined]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:withValU(ticket.assigned_to,function(a){return\"Assigned to: \".concat(a);})||\"Awaiting Assignment\"})]}),/*#__PURE__*/_jsxs(Col,{className:\"text-end\",md:\"auto\",children:[is_mine?/*#__PURE__*/_jsxs(Button,{className:\"mx-2\",variant:ticket.resolved?\"danger\":\"success\",onClick:function onClick(){return _this.update({resolved:{$set:!ticket.resolved}});},children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:ticket.resolved?faTimes:faCheck}),\"\\xA0 \",ticket.resolved?\"Unresolve\":\"Mark Resolved\"]}):undefined,is_mine?/*#__PURE__*/_jsxs(Button,{variant:\"danger\",onClick:function onClick(){return _this.update({assigned_to:{$set:null}});},disabled:ticket.resolved,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUserSlash}),\"\\xA0 Unassign Me\"]}):/*#__PURE__*/_jsxs(Button,{variant:\"success\",onClick:function onClick(){return _this.update({assigned_to:{$set:my_name}});},disabled:ticket.assigned_to!=null,children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faUserCheck}),\"\\xA0 Assign to Me\"]})]})]}),/*#__PURE__*/_jsxs(Row,{className:\"mb-3 ticket-content\",children:[/*#__PURE__*/_jsxs(Col,{md:3,className:\"ticket-notes\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\" Notes \"}),/*#__PURE__*/_jsx(BufferedFormControl,{resetOnEnter:true,size:\"sm\",placeholder:\"New Comment\",value:\"\",disabled:ticket.resolved,onEnter:function onEnter(v){return nullIfEmpty(String(v))&&_this.update({notes:{$push:[{author:my_name,comment:v,time:moment().utc().unix()}]}});}}),/*#__PURE__*/_jsx(\"br\",{}),ticket.notes.slice(0).reverse().map(function(note){return/*#__PURE__*/_jsx(Card,{className:\"ticket-note\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"m-0\",children:[\" \",note.comment,\" \"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"ticket-note-time text-muted\",children:[\" \",note.author,\" @ \",moment.unix(note.time).calendar(),\" \"]})]})});})]}),/*#__PURE__*/_jsx(Col,{md:9,children:ticket.match_id?/*#__PURE__*/_jsx(MatchLogView,{autoload:true,team:ticket.team,match_id:ticket.match_id}):/*#__PURE__*/_jsx(\"h6\",{className:\"text-muted\",children:\" No Logs Available - No Associated Match \"})})]})]});};return _this;}_createClass(TicketView,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(Col,{className:\"col-full\",children:this.state.ticket?this.renderTicket(this.state.ticket):/*#__PURE__*/_jsx(\"h3\",{children:\" Loading... \"})});}}]);return TicketView;}(WebsocketComponent);export{TicketView as default};","map":{"version":3,"names":["React","Button","Card","Col","Row","withValU","WebsocketComponent","get_csa_name","update","FontAwesomeIcon","faCheck","faChevronCircleLeft","faTimes","faUserCheck","faUserSlash","moment","BufferedFormControl","nullIfEmpty","Link","MatchLogView","TicketView","state","componentDidMount","handles","listenFn","ticks","setState","ticket","find","t","id","props","matches","match","m","match_id","spec","send","Ticket","Insert","renderTicket","my_name","fta","is_mine","assigned_to","team","issue_type","name","resolved","undefined","a","$set","v","String","notes","$push","author","comment","time","utc","unix","slice","reverse","map","note","calendar"],"sources":["/home/spacey_sooty/Documents/projects/JMS/jms-frontend/src/csa/Ticket.tsx"],"sourcesContent":["import { Spec } from \"immutability-helper\";\nimport React from \"react\";\nimport { Button, Card, Col, Row } from \"react-bootstrap\";\nimport { withValU } from \"support/util\";\nimport { WebsocketComponent } from \"support/ws-component\";\nimport { SerializedMatch, SupportTicket, TicketComment } from \"ws-schema\";\nimport { get_csa_name } from \"./CSAIndex\";\nimport update from \"immutability-helper\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faCheck, faChevronCircleLeft, faTimes, faUserCheck, faUserSlash } from \"@fortawesome/free-solid-svg-icons\";\nimport moment from \"moment\";\nimport BufferedFormControl from \"components/elements/BufferedFormControl\";\nimport { nullIfEmpty } from \"support/strings\";\nimport { Link } from \"react-router-dom\";\nimport MatchLogView from \"monitor/MatchLogView\";\n\ntype TicketProps = {\n  id: number,\n  fta: boolean\n};\n\ntype TicketState = {\n  ticket?: SupportTicket,\n  match?: SerializedMatch,\n}\n\nexport default class TicketView extends WebsocketComponent<TicketProps, TicketState> {\n  readonly state: TicketState = {};\n  \n  componentDidMount = () => {\n    this.handles = [\n      this.listenFn<SupportTicket[]>(\"Ticket/All\", ticks => this.setState({ ticket: ticks.find(t => t.id === this.props.id) })),\n      this.listenFn<SerializedMatch[]>(\"Match/All\", matches => this.setState(state => ({ match: matches.find(m => m.id === state.ticket?.match_id) })))\n    ]\n  }\n\n  update = (spec: Spec<SupportTicket>) => {\n    this.send({\n      Ticket: {\n        Insert: update(this.state.ticket!, spec)\n      }\n    })\n  }\n\n  renderTicket = (ticket: SupportTicket) => {\n    const { match } = this.state;\n    const my_name = get_csa_name(this.props.fta) || \"Unnamed CSA\";\n    const is_mine = ticket.assigned_to === my_name;\n\n    return <React.Fragment>\n      <Row className=\"ticket-header\">\n        <Col>\n          <h4>\n            <Link to=\"../\">\n              <Button\n                variant=\"secondary\"\n              > <FontAwesomeIcon icon={faChevronCircleLeft} /> </Button>\n            </Link> &nbsp;\n            Team {ticket.team} - { ticket.issue_type }\n            { withValU(match, m => ` in ${m.name}`) }\n            { ticket.resolved ? <span className=\"text-success\">\n              &nbsp; [RESOLVED]\n            </span> : undefined }\n          </h4>\n          <p className=\"text-muted\">\n            { withValU(ticket.assigned_to, a => `Assigned to: ${a}`) || \"Awaiting Assignment\" }\n          </p>\n        </Col>\n        <Col className=\"text-end\" md=\"auto\">\n          {\n            is_mine ? (\n              <Button className=\"mx-2\"\n                variant={ticket.resolved ? \"danger\" : \"success\"}\n                onClick={() => this.update({ resolved: { $set: !ticket.resolved } })}\n              >\n                <FontAwesomeIcon icon={ticket.resolved ? faTimes : faCheck} />\n                &nbsp; { ticket.resolved ? \"Unresolve\" : \"Mark Resolved\" }\n              </Button>\n             ) : undefined\n          }\n\n          {\n            is_mine ? \n              <Button\n                variant=\"danger\"\n                onClick={() => this.update({ assigned_to: { $set: null } })}\n                disabled={ticket.resolved}\n              >\n                <FontAwesomeIcon icon={faUserSlash} />\n               &nbsp; Unassign Me\n              </Button>\n              : <Button\n                variant=\"success\"\n                onClick={() => this.update({ assigned_to: { $set: my_name } })}\n                disabled={ticket.assigned_to != null}\n              >\n                <FontAwesomeIcon icon={faUserCheck} />\n                &nbsp; Assign to Me \n              </Button>\n          }\n        </Col>\n      </Row>\n      <Row className=\"mb-3 ticket-content\">\n        <Col md={3} className=\"ticket-notes\">\n          <h4> Notes </h4>\n          <BufferedFormControl\n            resetOnEnter\n            size=\"sm\"\n            placeholder=\"New Comment\"\n            value={\"\"}\n            disabled={ticket.resolved}\n            onEnter={(v) => nullIfEmpty(String(v)) && this.update({\n              notes: { $push: [{\n                author: my_name,\n                comment: v,\n                time: moment().utc().unix()\n              } as TicketComment]}\n            })}\n          />\n          <br />\n          {\n            ticket.notes.slice(0).reverse().map(note => <Card className=\"ticket-note\">\n              <Card.Body>\n                <p className=\"m-0\"> { note.comment } </p>\n                <p className=\"ticket-note-time text-muted\"> { note.author } @ { moment.unix(note.time).calendar() } </p>\n              </Card.Body>\n            </Card>)\n          }\n        </Col>\n        <Col md={9}>\n          {\n            ticket.match_id ? <MatchLogView autoload team={ticket.team} match_id={ticket.match_id} /> :\n              <h6 className=\"text-muted\"> No Logs Available - No Associated Match </h6>\n          }\n          \n        </Col>\n      </Row>\n    </React.Fragment>\n  }\n\n  render() {\n    return <Col className=\"col-full\">\n      { this.state.ticket ? this.renderTicket(this.state.ticket) : <h3> Loading... </h3> }\n    </Col>\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}