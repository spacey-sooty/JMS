{"ast":null,"code":"import _classCallCheck from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/spacey_sooty/Documents/projects/JMS/jms-frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{v4 as uuid}from'uuid';import resource_id,{clear_fta_key,get_fta_key}from\"./resourceid\";// Walk down the callback path and message path to get the final message type if applicable\nfunction walkCallback(msg,cb){// Check variant tree\nvar path=cb.path;var valid=true;var child_msg=msg;for(var i=0;i<path.length&&valid;i++){if(path[i]in child_msg){child_msg=child_msg[path[i]];}else if(path[i]===child_msg){// Special case for unit variants\nchild_msg={};}else{valid=false;}}// Dispatch\nif(valid){cb.fn(child_msg,msg);return true;}return false;}var MAX_SEQ_NUM=65535;var JmsWebsocket=/*#__PURE__*/function(){function JmsWebsocket(){var _this=this;var url=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"ws://\"+window.location.hostname+\":9000\";var timeout=arguments.length>1&&arguments[1]!==undefined?arguments[1]:250;_classCallCheck(this,JmsWebsocket);this.url=void 0;this.timeout=void 0;this.ws=void 0;this.connectCallbacks=void 0;this.callbacks=void 0;this.sendQueue=void 0;this.role=void 0;this.seq_num=void 0;this.reply_waiting=void 0;this.updateRole=function(role,location){if(location!==_this.role[1]||_this.role[1]===\"Unknown\"){_this.role=[role,location];_this.send({Resource:{SetRole:role}});}};this.transact=function(msg,path){var actual_path=path==null?[]:typeof path==='string'?path.split(\"/\"):path;var seq=_this.seq_num;var that=_this;var p=new Promise(function(resolve,reject){that.reply_waiting.set(seq,{path:actual_path,fn:function fn(v,full){return resolve({msg:v,full:full});},reject:reject});});_this.send(msg);return p;};this.url=url;this.timeout=timeout;this.callbacks=new Map();this.connectCallbacks=new Map();this.sendQueue=[];this.role=[\"Unknown\",\"\"];this.seq_num=0;this.reply_waiting=new Map();this.connect=this.connect.bind(this);this.dead=this.dead.bind(this);this.alive=this.alive.bind(this);this.tryReconnect=this.tryReconnect.bind(this);this.send=this.send.bind(this);this.onMessage=this.onMessage.bind(this);this.onConnectChange=this.onConnectChange.bind(this);}_createClass(JmsWebsocket,[{key:\"connect\",value:function connect(){var _this2=this;var that=this;var timer;var ws=new WebSocket(this.url);ws.onopen=function(){console.log(\"WS Connected\");setTimeout(function(){_this2.send({Resource:{SetID:resource_id()}});if(get_fta_key()!=null){_this2.transact({Resource:{SetFTA:get_fta_key()}},\"Resource/SetFTAAck\").then(function(b){if(!b.msg)clear_fta_key();});}// this.transact<any>({ Resource: { SetID: resource_id() } }, [])\n//   .then(() => {\n//     console.log(\"WS Ack'd ID\");\n//     this.connectCallbacks.forEach(cb => cb(true));\n//     this.callbacks.forEach(cb => this.send({ Subscribe: cb.path }));\n//     this.sendQueue.forEach(sq => this.sendNow(sq));\n//     this.sendQueue = [];\n//     this.send({ Resource: { SetRole: this.role[0] } });\n//   });\nsetTimeout(function(){_this2.connectCallbacks.forEach(function(cb){return cb(true);});_this2.callbacks.forEach(function(cb){return _this2.send({Subscribe:cb.path});});_this2.send({Subscribe:[\"Ping\"]});_this2.sendQueue.forEach(function(sq){return _this2.sendNow(sq);});_this2.sendQueue=[];_this2.send({Resource:{SetRole:_this2.role[0]}});},500);},100);that.ws=ws;clearTimeout(timer);};ws.onclose=function(e){console.log(\"WS Closed, retrying...\",e.reason);_this2.connectCallbacks.forEach(function(cb){return cb(false);});timer=setTimeout(that.tryReconnect,that.timeout);};ws.onerror=function(err){console.log(\"WS Error, closing...\",err);_this2.connectCallbacks.forEach(function(cb){return cb(false);});ws.close();};ws.onmessage=function(msg){var meta=JSON.parse(msg.data);var message=meta.msg;if(meta.reply!=null){// Reconcile Reply\nvar waiting=_this2.reply_waiting.get(meta.reply);if(waiting!=null){if(!walkCallback(message,waiting)){waiting.reject(\"Reply callback not assignable to promise - is the path correct?\");}_this2.reply_waiting.delete(meta.reply);}else{console.warn(\"Got a reply for SID \".concat(meta.reply,\" but there are no waiting promises!\"));}}else if(message===\"Ping\"){_this2.send(\"Pong\");}else{// Trigger all callbacks whom apply\n_this2.callbacks.forEach(function(cb){walkCallback(message,cb);});}};}},{key:\"close\",value:function close(){var _this$ws;(_this$ws=this.ws)===null||_this$ws===void 0?void 0:_this$ws.close();}},{key:\"dead\",value:function dead(){return!this.ws||this.ws.readyState===WebSocket.CLOSED;}},{key:\"alive\",value:function alive(){return!this.dead();}},{key:\"tryReconnect\",value:function tryReconnect(){if(this.dead())this.connect();}},{key:\"send\",value:function send(msg){this.sendMeta({msg:msg,seq:this.seq_num++});if(this.seq_num>=MAX_SEQ_NUM)this.seq_num=0;}},{key:\"sendMeta\",value:function sendMeta(meta){if(this.alive()&&this.sendQueue.length===0){this.sendNow(meta);}else{// console.log(\"Can't send message, WS dead :X\", msg);\nthis.sendQueue.push(meta);}}},{key:\"sendNow\",value:function sendNow(meta){this.ws.send(JSON.stringify(meta));}},{key:\"onMessage\",value:function onMessage(path,callback){var actual_path=typeof path==='string'?path.split(\"/\"):path;var id=uuid();this.callbacks.set(id,{path:actual_path,fn:callback});if(this.alive()){this.send({Subscribe:actual_path});}return id;}},{key:\"removeHandle\",value:function removeHandle(id){if(this.callbacks.has(id))this.callbacks.delete(id);if(this.connectCallbacks.has(id))this.connectCallbacks.delete(id);}},{key:\"removeHandles\",value:function removeHandles(ids){// Sometimes set as undefined when live-reloading in dev\nif(ids!==undefined&&this!==undefined&&this.removeHandle!==undefined)ids.forEach(this.removeHandle);}},{key:\"onConnectChange\",value:function onConnectChange(cb){var id=uuid();this.connectCallbacks.set(id,cb);cb(this.alive());return id;}}]);return JmsWebsocket;}();export{JmsWebsocket as default};","map":{"version":3,"names":["v4","uuid","resource_id","clear_fta_key","get_fta_key","walkCallback","msg","cb","path","valid","child_msg","i","length","fn","MAX_SEQ_NUM","JmsWebsocket","url","window","location","hostname","timeout","ws","connectCallbacks","callbacks","sendQueue","role","seq_num","reply_waiting","updateRole","send","Resource","SetRole","transact","actual_path","split","seq","that","p","Promise","resolve","reject","set","v","full","Map","connect","bind","dead","alive","tryReconnect","onMessage","onConnectChange","timer","WebSocket","onopen","console","log","setTimeout","SetID","SetFTA","then","b","forEach","Subscribe","sq","sendNow","clearTimeout","onclose","e","reason","onerror","err","close","onmessage","meta","JSON","parse","data","message","reply","waiting","get","delete","warn","readyState","CLOSED","sendMeta","push","stringify","callback","id","has","ids","undefined","removeHandle"],"sources":["/home/spacey_sooty/Documents/projects/JMS/jms-frontend/src/support/ws.ts"],"sourcesContent":["import { RecvMeta, ResourceRole, SendMeta, WebsocketMessage2JMS, WebsocketMessage2UI } from \"ws-schema\";\nimport { v4 as uuid } from 'uuid';\nimport resource_id, { clear_fta_key, get_fta_key } from \"./resourceid\";\n\nexport type CallbackFn<T> = (msg: T, fullMessage: WebsocketMessage2UI) => void;\nexport type ConnectCallback = (isOpen: boolean) => void;\ntype Callback<T> = {\n  path: string[],\n  fn: CallbackFn<T>\n};\n\nexport type TransactPromiseV<T> = { msg: T, full: WebsocketMessage2UI };\nexport type TransactPromise<T> = Promise<TransactPromiseV<T>>;\n\n// Walk down the callback path and message path to get the final message type if applicable\nfunction walkCallback(msg: WebsocketMessage2UI, cb: Callback<any>): boolean {\n  // Check variant tree\n  let path = cb.path;\n  let valid = true;\n  let child_msg: any = msg;\n  for (let i = 0; i < path.length && valid; i++) {\n    if (path[i] in child_msg) {\n      child_msg = child_msg[path[i]];\n    } else if (path[i] === child_msg) {\n      // Special case for unit variants\n      child_msg = {};\n    } else {\n      valid = false;\n    }\n  }\n\n  // Dispatch\n  if (valid) {\n    cb.fn(child_msg, msg);\n    return true;\n  }\n  return false;\n}\n\nconst MAX_SEQ_NUM = 65535;\n\nexport default class JmsWebsocket {\n  url: string;\n  timeout: number;\n  ws?: WebSocket;\n  connectCallbacks: Map<string, ConnectCallback>;\n  callbacks: Map<string, Callback<any>>;\n  sendQueue: RecvMeta[];\n  role: [ResourceRole, string];\n  seq_num: number;\n  reply_waiting: Map<number, Callback<any> & { reject: (r: any) => void }>;\n\n  constructor(url=\"ws://\" + window.location.hostname + \":9000\", timeout=250) {\n    this.url = url;\n    this.timeout = timeout;\n    this.callbacks = new Map<string, Callback<any>>();\n    this.connectCallbacks = new Map<string, ConnectCallback>();\n    this.sendQueue = [];\n    this.role = [ \"Unknown\", \"\" ];\n    this.seq_num = 0;\n    this.reply_waiting = new Map<number, Callback<any> & { reject: (r: any) => void }>();\n\n    this.connect = this.connect.bind(this);\n    this.dead = this.dead.bind(this);\n    this.alive = this.alive.bind(this);\n    this.tryReconnect = this.tryReconnect.bind(this);\n    this.send = this.send.bind(this);\n    this.onMessage = this.onMessage.bind(this);\n    this.onConnectChange = this.onConnectChange.bind(this);\n  }\n\n  connect() {\n    let that = this;\n    var timer: any;\n    var ws = new WebSocket(this.url);\n\n    ws.onopen = () => {\n      console.log(\"WS Connected\");\n      setTimeout(() => {\n        this.send({ Resource: { SetID: resource_id() } });\n        if (get_fta_key() != null) {\n          this.transact({ Resource: { SetFTA: get_fta_key() } }, \"Resource/SetFTAAck\")\n            .then(b => {\n              if (!b.msg)\n                clear_fta_key();\n            })\n        }\n        // this.transact<any>({ Resource: { SetID: resource_id() } }, [])\n        //   .then(() => {\n        //     console.log(\"WS Ack'd ID\");\n        //     this.connectCallbacks.forEach(cb => cb(true));\n        //     this.callbacks.forEach(cb => this.send({ Subscribe: cb.path }));\n        //     this.sendQueue.forEach(sq => this.sendNow(sq));\n        //     this.sendQueue = [];\n        //     this.send({ Resource: { SetRole: this.role[0] } });\n        //   });\n        setTimeout(() => {\n          this.connectCallbacks.forEach(cb => cb(true));\n          this.callbacks.forEach(cb => this.send({ Subscribe: cb.path }));\n          this.send({ Subscribe: [\"Ping\"] });\n          this.sendQueue.forEach(sq => this.sendNow(sq));\n          this.sendQueue = [];\n          this.send({ Resource: { SetRole: this.role[0] } });\n        }, 500);\n      }, 100);\n      that.ws = ws;\n      clearTimeout(timer);\n    };\n\n    ws.onclose = e => {\n      console.log(\"WS Closed, retrying...\", e.reason);\n      this.connectCallbacks.forEach(cb => cb(false));\n      timer = setTimeout(that.tryReconnect, that.timeout);\n    };\n\n    ws.onerror = err => {\n      console.log(\"WS Error, closing...\", err);\n      this.connectCallbacks.forEach(cb => cb(false));\n      ws.close();\n    };\n\n    ws.onmessage = msg => {\n      let meta = JSON.parse(msg.data) as SendMeta;\n      let message = meta.msg;\n\n      if (meta.reply != null) {\n        // Reconcile Reply\n        const waiting = this.reply_waiting.get(meta.reply);\n        if (waiting != null) {\n          if (!walkCallback(message, waiting)) {\n            waiting.reject(`Reply callback not assignable to promise - is the path correct?`);\n          }\n          this.reply_waiting.delete(meta.reply);\n        } else {\n          console.warn(`Got a reply for SID ${meta.reply} but there are no waiting promises!`);\n        }\n      } else if (message === \"Ping\") {\n        this.send(\"Pong\");\n      } else {\n        // Trigger all callbacks whom apply\n        this.callbacks.forEach(cb => {\n          walkCallback(message, cb);\n        });\n      }\n    };\n  }\n\n  close() {\n    this.ws?.close();\n  }\n\n  dead() {\n    return !this.ws || this.ws.readyState === WebSocket.CLOSED;\n  }\n\n  alive() {\n    return !this.dead();\n  }\n\n  tryReconnect() {\n    if (this.dead())\n      this.connect();\n  }\n\n  updateRole = (role: ResourceRole, location: string) => {\n    if (location !== this.role[1] || this.role[1] === \"Unknown\") {\n      this.role = [role, location];\n      this.send({ Resource: { SetRole: role } });\n    }\n  }\n\n  send(msg: WebsocketMessage2JMS) {\n    this.sendMeta({ msg, seq: this.seq_num++ });\n    if (this.seq_num >= MAX_SEQ_NUM)\n      this.seq_num = 0;\n  }\n\n  transact = <T,>(msg: WebsocketMessage2JMS, path?: string[]|string): TransactPromise<T> => {\n    const actual_path = path == null ? [] : typeof path === 'string' ? path.split(\"/\") : path;\n\n    let seq = this.seq_num;\n    let that = this;\n    let p = new Promise<TransactPromiseV<T>>((resolve, reject) => {\n      that.reply_waiting.set(seq, { \n        path: actual_path,\n        fn: (v: any, full) => resolve({ msg: (v as T), full }),\n        reject\n      });\n    });\n    this.send(msg);\n    return p;\n  }\n\n  sendMeta(meta: RecvMeta) {\n    if (this.alive() && this.sendQueue.length === 0) {\n      this.sendNow(meta);\n    } else {\n      // console.log(\"Can't send message, WS dead :X\", msg);\n      this.sendQueue.push(meta);\n    }\n  }\n  \n  sendNow(meta: RecvMeta) {\n    this.ws!.send(JSON.stringify(meta));\n  }\n\n  onMessage<T>(path: string[]|string, callback: CallbackFn<T>): string {\n    const actual_path = typeof path === 'string' ? path.split(\"/\") : path;\n\n    let id = uuid();\n    this.callbacks.set(id, {\n      path: actual_path,\n      fn: callback\n    });\n\n    if (this.alive()) {\n      this.send({ Subscribe: actual_path });\n    }\n\n    return id;\n  }\n\n  removeHandle(id: string) {\n    if (this.callbacks.has(id))\n      this.callbacks.delete(id);\n    if (this.connectCallbacks.has(id))\n      this.connectCallbacks.delete(id);\n  }\n\n  removeHandles(ids?: string[]) {\n    // Sometimes set as undefined when live-reloading in dev\n    if (ids !== undefined && this !== undefined && this.removeHandle !== undefined)\n      ids.forEach(this.removeHandle);\n  }\n\n  onConnectChange(cb: ConnectCallback): string {\n    let id = uuid();\n    this.connectCallbacks.set(id, cb);\n    cb(this.alive());\n    return id;\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}